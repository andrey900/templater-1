function Templater(e){this.template=e}Templater.prototype.compile=function(e){var t=/{{(.*?)}}/g;var l,i;while(l=t.exec(this.template)){var a="";if(!/[!#/]/.test(l[1]))this.template=this.template.replace(l[0],s(e,l[1]));else{if(i=/{{!?#(.+?)}}([^]+?){{\/\1}}/g.exec(this.template.substr(t.lastIndex-l[0].length))){var p=s(e,i[1]);if(p&&p.forEach)p.forEach(function(e){a+=new Templater(i[2]).compile(e)});else if(/{{!#.*?}}/.test(i[0]))a=p?new Templater(i[2]).compile(s(e,i[1])):"";else a=p?new Templater(i[2]).compile(e):"";this.template=this.template.replace(i[0],a)}else this.template=this.template.replace(/{/g,"&#123;")}t.lastIndex-=l[0].length}return this.template;function s(e,t){var l;if(/[.]/.test(t)){if(t===".")return e;else{l=t.split(".");return s(e[l.shift()],l.join("."))}}else{l=t.split(" ");var i=l.shift();return typeof e[i]==="function"?e[i].apply(e,l):e[i]}}};